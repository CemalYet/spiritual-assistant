# Spiritual Assistant - Hardware Design

> **Battery-Powered Prayer Clock with TFT Display**  
> ESP32-C3 based, 4Ã—AA batteries, ~2.8 months battery life

---

## ðŸ“‹ Table of Contents

1. [Overview](#overview)
2. [Bill of Materials (BOM)](#bill-of-materials-bom)
3. [Power System](#power-system)
4. [Main MCU - ESP32-C3](#main-mcu---esp32-c3)
5. [Display - TFT 2.4" ILI9341](#display---tft-24-ili9341)
6. [RTC - DS3231M](#rtc---ds3231m)
7. [Audio - MAX98357A](#audio---max98357a)
8. [Buttons](#buttons)
9. [USB-C Connector](#usb-c-connector)
10. [Pin Assignment Table](#pin-assignment-table)
11. [Power Logic](#power-logic)
12. [PCB Layout](#pcb-layout)

---

## Overview

| Specification | Value |
|---------------|-------|
| **MCU** | ESP32-C3-WROOM-02 (8MB Flash) |
| **Display** | TFT 2.4" ILI9341 (320Ã—240) |
| **Power** | 4Ã—AA Batteries (6V) + USB-C |
| **Battery Life** | ~2.8 months |
| **Deep Sleep Current** | ~8ÂµA |
| **Audio** | I2S DAC + 3W Speaker |
| **RTC** | DS3231M with CR1220 backup |
| **Total Cost** | â‚¬14.05 |

---

## Bill of Materials (BOM)

| Part | Description | Price |
|------|-------------|-------|
| ESP32-C3-WROOM-02 | 8MB Flash, WiFi/BLE | â‚¬2.20 |
| TFT 2.4" ILI9341 | 320Ã—240 bare panel | â‚¬2.80 |
| FPC 40-pin connector | Display connector | â‚¬0.25 |
| DS3231M | RTC with TCXO | â‚¬1.50 |
| CR1220 holder | RTC backup battery | â‚¬0.10 |
| MAX98357A | I2S Audio Amplifier | â‚¬0.80 |
| Speaker 3W 4Î© | Mini speaker | â‚¬0.60 |
| MP2359 | Buck converter IC | â‚¬0.30 |
| AP2112K-3.3 | LDO regulator | â‚¬0.10 |
| USB-C Connector | 16-pin SMD | â‚¬0.15 |
| Tactile Switch Ã—3 | 6Ã—6mm buttons | â‚¬0.15 |
| AO3400 MOSFET Ã—2 | N-channel SOT-23 | â‚¬0.10 |
| SS14 Schottky Ã—3 | 1A 40V diodes | â‚¬0.15 |
| 10ÂµH Inductor | Power inductor | â‚¬0.10 |
| USBLC6-2 | USB ESD protection | â‚¬0.15 |
| Passives | Caps, resistors | â‚¬0.50 |
| 4Ã—AA Holder | Battery holder | â‚¬0.40 |
| PCB + Assembly | 2-layer PCB | â‚¬3.70 |
| **TOTAL** | | **â‚¬14.05** |

---

## Power System

### Dual Power Path Architecture

The system supports both battery and USB power with automatic switching.

```
4Ã—AA BATTERIES (6V)                              USB-C (5V)
        â”‚                                            â”‚
        â”‚                                            â”‚
        â–¼                                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    MP2359     â”‚                           â”‚   AP2112K     â”‚
â”‚  Buck Conv.   â”‚                           â”‚     LDO       â”‚
â”‚   6V â†’ 3.3V   â”‚                           â”‚  5V â†’ 3.3V    â”‚
â”‚   Î· = 90%     â”‚                           â”‚   Î· = 66%     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                           â”‚
        â”‚    SS14                          SS14     â”‚
        â””â”€â”€â”€â”€â–¶â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ—€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  3.3V RAIL  â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          â”‚          â”‚
        â–¼          â–¼          â–¼
    ESP32-C3    DS3231     Display
                 RTC
```

### MP2359 Buck Converter (Battery Path)

```
BATTERY 6V â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                    â”‚
              â•â•§â• 22ÂµF              â”‚
               â”‚                    â”‚
              GND            â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                             â”‚   MP2359    â”‚
                             â”‚             â”‚
                    10ÂµH     â”‚  VIN    SW â”€â”¼â”€â”€â”
                â”Œâ”€â”€â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”€â”€â”  â”‚             â”‚  â”‚
                â”‚         â”‚  â”‚  FB    GND â”€â”¼â”€â”€â”¼â”€â”€ GND
                â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”¤             â”‚  â”‚
                â”‚    â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                â”‚    â”‚                        â”‚
                â”‚    â”‚   Feedback Network     â”‚
                â”‚    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                â”‚    â””â”€â”€â”€â”¤ 16K    5.6K   â”‚    â”‚
                â”‚        â”‚   â”‚      â”‚    â”‚    â”‚
                â”‚        â”‚   â””â”€â”€â”¬â”€â”€â”€â”˜    â”‚    â”‚
                â”‚        â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                â”‚               â”‚             â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                              â•â•§â• 22ÂµF
                                â”‚
                               GND
                                â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ 3.3V OUT
```

> **Note:** Vout = 0.6V Ã— (1 + 16K/5.6K) = **3.31V**

### USB Detection Circuit

```
USB 5V â”€â”€â”¬â”€â”€â”€ 5.6K â”€â”€â”€â”¬â”€â”€â”€ 10K â”€â”€â”€â”¬â”€â”€â”€ GND
         â”‚            â”‚           â”‚
         â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â–¶ GPIO9 (USB_DETECT)
         â”‚                              ~3.2V when USB connected
         â–¼                              HIGH = USB, LOW = Battery
     To AP2112K
```

> **Note:** Voltage at GPIO9 = 5V Ã— 10K/(5.6K+10K) = **3.2V** (well above 2.475V HIGH threshold, below 3.3V max)

---

## Main MCU - ESP32-C3

### ESP32-C3-WROOM-02 Pinout

```
                              VCC 3.3V
                                  â”‚
                            â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                            â”‚   100nF   â”‚  (decoupling)
                            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                 GND

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                      â”‚
    â”‚              ESP32-C3-WROOM-02 (8MB)                 â”‚
    â”‚                                                      â”‚
    â”‚   3V3 â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â— VCC 3.3V â”‚
    â”‚   GND â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â— GND      â”‚
    â”‚                                                      â”‚
    â”‚   GPIO0  â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ BTN1 (Wake/Settings)   â”‚
    â”‚   GPIO1  â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ BTN2 (Volume +)        â”‚
    â”‚   GPIO20 â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ BTN3 (Volume -)        â”‚
    â”‚                                                       â”‚
    â”‚   GPIO2  â—â”€â”€â”€â”€ SDA â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ DS3231 SDA             â”‚
    â”‚   GPIO3  â—â”€â”€â”€â”€ SCL â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ DS3231 SCL             â”‚
    â”‚   GPIO21 â—â”€â”€â”€â”€ INT â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ DS3231 SQW/INT         â”‚
    â”‚                                                      â”‚
    â”‚   GPIO4  â—â”€â”€â”€â”€ BCLK â”€â”€â”€â”€â”€â”€â”€â”€â–¶ MAX98357 BCLK          â”‚
    â”‚   GPIO5  â—â”€â”€â”€â”€ LRC â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ MAX98357 LRC           â”‚
    â”‚   GPIO6  â—â”€â”€â”€â”€ DOUT â”€â”€â”€â”€â”€â”€â”€â”€â–¶ MAX98357 DIN           â”‚
    â”‚   GPIO7  â—â”€â”€â”€â”€ AMP_EN â”€â”€â”€â”€â”€â”€â–¶ MAX98357 SD            â”‚
    â”‚                                                      â”‚
    â”‚   GPIO10 â—â”€â”€â”€â”€ TFT_CLK â”€â”€â”€â”€â”€â–¶ ILI9341 CLK            â”‚
    â”‚   GPIO11 â—â”€â”€â”€â”€ TFT_MOSI â”€â”€â”€â”€â–¶ ILI9341 MOSI           â”‚
    â”‚   GPIO12 â—â”€â”€â”€â”€ TFT_CS â”€â”€â”€â”€â”€â”€â–¶ ILI9341 CS             â”‚
    â”‚   GPIO13 â—â”€â”€â”€â”€ TFT_DC â”€â”€â”€â”€â”€â”€â–¶ ILI9341 DC             â”‚
    â”‚   GPIO14 â—â”€â”€â”€â”€ TFT_RST â”€â”€â”€â”€â”€â–¶ ILI9341 RST            â”‚
    â”‚   GPIO8  â—â”€â”€â”€â”€ TFT_BL â”€â”€â”€â”€â”€â”€â–¶ MOSFET Gate            â”‚
    â”‚                                                      â”‚
    â”‚   GPIO9  â—â”€â”€â”€â”€ USB_DETECT â”€â”€â–¶ USB 5V Divider         â”‚
    â”‚                                                      â”‚
    â”‚   GPIO18 â—â”€â”€â”€â”€ USB D- â”€â”€â”€â”€â”€â”€â–¶ USB-C D-               â”‚
    â”‚   GPIO19 â—â”€â”€â”€â”€ USB D+ â”€â”€â”€â”€â”€â”€â–¶ USB-C D+               â”‚
    â”‚                                                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Display - TFT 2.4" ILI9341

### Display Connections

```
            TFT 2.4" ILI9341
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
          â”‚   â”‚             â”‚   â”‚
          â”‚   â”‚   DISPLAY   â”‚   â”‚
          â”‚   â”‚   320Ã—240   â”‚   â”‚
          â”‚   â”‚             â”‚   â”‚
          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
          â”‚                     â”‚
          â””â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”˜
             â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚
            VCC GND CLK MOSI CS DC RST BL
             â”‚  â”‚  â”‚   â”‚   â”‚  â”‚  â”‚   â”‚
             â”‚  â”‚  â”‚   â”‚   â”‚  â”‚  â”‚   â”‚
             â”‚  â”‚  â”‚   â”‚   â”‚  â”‚  â”‚   â””â”€â”€â”€ MOSFET
             â”‚  â”‚  â”‚   â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€ GPIO14
             â”‚  â”‚  â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GPIO13
             â”‚  â”‚  â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GPIO12
             â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GPIO11
             â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GPIO10
             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GND
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 3.3V
```

### Backlight MOSFET Control

```
GPIO8 â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚        â”‚
             10K     â”Œâ”€â”´â”€â”
              â”‚      â”‚ G â”‚
             GND     â”‚   â”‚  AO3400
                     â”‚ S â”‚  N-MOSFET
                     â””â”€â”¬â”€â”˜
                       â”‚ D
                       â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ TFT Backlight (-)
                       
TFT BL (+) â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 3.3V
```

> **Note:** GPIO8 HIGH = Backlight ON, GPIO8 LOW = Backlight OFF  
> 10K pull-down ensures backlight is OFF during deep sleep.

---

## RTC - DS3231M

### DS3231M Connections

```
              DS3231M RTC Module
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚    â—‹ â—‹ â—‹            â”‚  â† CR1220 backup battery
            â”‚   â”Œâ”€â”€â”€â”€â”€â”           â”‚
            â”‚   â”‚CHIP â”‚ Â±2ppm     â”‚
            â”‚   â””â”€â”€â”€â”€â”€â”˜           â”‚
            â”‚                     â”‚
            â””â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”€â”˜
               â”‚  â”‚  â”‚  â”‚  â”‚  â”‚
              VCC GND SDA SCL 32K SQW
               â”‚  â”‚  â”‚   â”‚   â”‚   â”‚
               â”‚  â”‚  â”‚   â”‚   â”‚   â””â”€â”€â”€â–¶ GPIO21 (Wake Interrupt)
               â”‚  â”‚  â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â–¶ NC (not used)
               â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ GPIO3 (I2C SCL)
               â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ GPIO2 (I2C SDA)
               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ GND
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ 3.3V
```

### I2C Pull-up Resistors

```
3.3V â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€
       â”‚                       â”‚
      4.7K                    4.7K
       â”‚                       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â–¶ SDA (GPIO2)   â”œâ”€â”€â”€â”€â”€â”€â”€â–¶ SCL (GPIO3)
       â”‚                       â”‚
       â””â”€â”€â”€ DS3231 SDA         â””â”€â”€â”€ DS3231 SCL
```

### SQW/INT Pull-up (Wake Interrupt)

```
3.3V â”€â”€â”€ 10K â”€â”€â”€â”¬â”€â”€â”€ GPIO21
                â”‚
                â””â”€â”€â”€ DS3231 SQW/INT (open-drain)
```

> **Note:** DS3231 SQW/INT is open-drain, requires external pull-up for proper HIGH level.

---

## Audio - MAX98357A

### MAX98357A I2S Amplifier

```
                MAX98357A
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                   â”‚
   3.3V â”€â”€â”€â”€â”¤ VIN         OUT+ â”œâ”€â”€â”€â”€â”€â”€â”€â”
            â”‚                   â”‚      â”‚
    GND â”€â”€â”€â”€â”¤ GND         OUT- â”œâ”€â”€â”€â”   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                   â”‚  â”‚   â”‚     â”‚              â”‚
 GPIO7 â”€â”€â”€â”€â”¤ SD          GAIN  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤   SPEAKER    â”‚
            â”‚                   â”‚  â”‚   â”‚     â”‚    3W 4Î©     â”‚
 GPIO4 â”€â”€â”€â”€â”¤ BCLK               â”‚  â”‚   â””â”€â”€â”€â”€â”€â”¤              â”‚
            â”‚                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
 GPIO5 â”€â”€â”€â”€â”¤ LRC                â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                   â”‚
 GPIO6 â”€â”€â”€â”€â”¤ DIN                â”‚
            â”‚                   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Pin | Connection | Function |
|-----|------------|----------|
| VIN | 3.3V | Power supply |
| GND | GND | Ground |
| SD | GPIO7 | Shutdown (HIGH = ON) |
| BCLK | GPIO4 | I2S Bit Clock |
| LRC | GPIO5 | I2S Left/Right Clock |
| DIN | GPIO6 | I2S Data In |
| GAIN | GND | 9dB gain (or VIN for 15dB) |
| OUT+/- | Speaker | Differential output |

---

## Buttons

### Button Circuit (Ã—3)

```
        3.3V
          â”‚
         10K  (pull-up)
          â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ GPIO (0, 1, or 20)
          â”‚
        â”Œâ”€â”´â”€â”
        â”‚   â”‚  Tactile
        â”‚ â—‹ â”‚  Switch
        â”‚   â”‚  (6Ã—6mm)
        â””â”€â”¬â”€â”˜
          â”‚
         GND
```

| Button | GPIO | Function |
|--------|------|----------|
| BTN1 | GPIO0 | Wake from sleep / Settings (long press) |
| BTN2 | GPIO1 | Volume + |
| BTN3 | GPIO20 | Volume - |

> **Note:** Buttons are active LOW (pressed = 0, released = 1)  
> GPIO0 also used as wake source from deep sleep.

---

## USB-C Connector

### USB-C Pinout

```
                   USB-C Connector (16-pin)
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹  â”‚
                  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
                  â”‚     â”‚           â”‚     â”‚
                  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                  â”‚                       â”‚
                  â”‚  A1  ...  A12         â”‚
                  â”‚  B1  ...  B12         â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### USB-C Wiring

| Pin(s) | Signal | Connection |
|--------|--------|------------|
| A4, B4, A9, B9 | VBUS | â†’ AP2112K VIN, USB detect divider |
| A7 | D- | â†’ 22Î© â†’ GPIO18 |
| A6 | D+ | â†’ 22Î© â†’ GPIO19 |
| A5 | CC1 | â†’ 5.1K â†’ GND |
| B5 | CC2 | â†’ 5.1K â†’ GND |
| A1, B1, A12, B12 | GND | â†’ GND |
| Shield | Shield | â†’ GND (via 1M + 100pF) |

### USB Data Lines with ESD Protection

```
USB D- (A7) â”€â”€â”€â”€â”¬â”€â”€â”€â”€ 22Î© â”€â”€â”€â”€â”€â”€â–¶ GPIO18
                â”‚
               â•â•§â•  USBLC6-2
                â”‚   (ESD Diodes)
USB D+ (A6) â”€â”€â”€â”€â”¬â”€â”€â”€â”€ 22Î© â”€â”€â”€â”€â”€â”€â–¶ GPIO19
                â”‚
               â•â•§â•
                â”‚
               GND
```

---

## Pin Assignment Table

| GPIO | Function | Direction | Notes |
|------|----------|-----------|-------|
| 0 | BTN1 | Input | Wake + Settings (long press) |
| 1 | BTN2 | Input | Volume + |
| 2 | I2C SDA | I/O | RTC data line |
| 3 | I2C SCL | Output | RTC clock line |
| 4 | I2S BCLK | Output | Audio bit clock |
| 5 | I2S LRC | Output | Audio L/R clock |
| 6 | I2S DOUT | Output | Audio data |
| 7 | AMP Enable | Output | HIGH = audio on |
| 8 | TFT Backlight | Output | PWM for brightness |
| 9 | USB Detect | Input | HIGH = USB connected |
| 10 | TFT CLK | Output | SPI clock |
| 11 | TFT MOSI | Output | SPI data |
| 12 | TFT CS | Output | Chip select (active LOW) |
| 13 | TFT DC | Output | Data/Command select |
| 14 | TFT RST | Output | Reset (active LOW) |
| 18 | USB D- | I/O | USB data minus |
| 19 | USB D+ | I/O | USB data plus |
| 20 | BTN3 | Input | Volume - |
| 21 | RTC INT | Input | Wake alarm (active LOW) |

---

## Power Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         POWER MODES                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  USB CONNECTED (GPIO9 = HIGH)                               â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  â€¢ Power: USB 5V â†’ AP2112K â†’ 3.3V                           â”‚    â”‚
â”‚  â”‚  â€¢ Battery: Disconnected (Schottky reverse biased)          â”‚    â”‚
â”‚  â”‚  â€¢ Display: Always ON                                       â”‚    â”‚
â”‚  â”‚  â€¢ WiFi: Always connected                                   â”‚    â”‚
â”‚  â”‚  â€¢ Settings server: Always running                          â”‚    â”‚
â”‚  â”‚  â€¢ Current: ~80mA typical                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  BATTERY ONLY (GPIO9 = LOW)                                 â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  â€¢ Power: 6V Battery â†’ MP2359 Buck â†’ 3.3V                   â”‚    â”‚
â”‚  â”‚  â€¢ Display: OFF (wake on button/prayer time)                â”‚    â”‚
â”‚  â”‚  â€¢ WiFi: OFF (enable on long press BTN1)                    â”‚    â”‚
â”‚  â”‚  â€¢ Deep sleep between events                                â”‚    â”‚
â”‚  â”‚  â€¢ Current: ~8ÂµA (deep sleep)                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  BOTH CONNECTED                                             â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  â€¢ USB wins (higher voltage through Schottky OR-ing)        â”‚    â”‚
â”‚  â”‚  â€¢ Battery ready as backup                                  â”‚    â”‚
â”‚  â”‚  â€¢ Seamless switching if USB removed                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Battery Life Calculation

| State | Current | Duration/Day | Energy |
|-------|---------|--------------|--------|
| Deep Sleep | 8ÂµA | 23.75 hours | 190ÂµAh |
| Wake + Display | 35mA | 12 min | 7mAh |
| Adhan Playback | 150mA | 3 min | 7.5mAh |
| **Total per day** | | | **~15mAh** |

**4Ã—AA Batteries (2500mAh) Ã· 15mAh/day = ~166 days â‰ˆ 2.8 months**

---

## PCB Layout

### Component Placement (Top View)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              80mm                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚                      DISPLAY AREA                            â”‚  â”‚
â”‚  â”‚                   TFT 2.4" ILI9341                           â”‚  â”‚
â”‚  â”‚                      320Ã—240                                 â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚            â”‚  â”‚        â”‚  â”‚          â”‚  â”‚                â”‚      â”‚
â”‚  â”‚  ESP32-C3  â”‚  â”‚ DS3231 â”‚  â”‚ MAX98357 â”‚  â”‚   MP2359 Buck  â”‚      â”‚
â”‚  â”‚  WROOM-02  â”‚  â”‚  RTC   â”‚  â”‚   Amp    â”‚  â”‚   + AP2112K    â”‚      â”‚
â”‚  â”‚            â”‚  â”‚        â”‚  â”‚          â”‚  â”‚                â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                    â”‚
â”‚  [BTN1]  [BTN2]  [BTN3]          [Speaker]           [USB-C]       â”‚
â”‚   Wake    Vol+    Vol-                                             â”‚
â”‚                                                                    â”‚
â”‚  â—‹ LED (Status - optional)                                         â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 4Ã—AA Battery Holder (Below PCB) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
```

### Recommended PCB Specifications

| Parameter | Value |
|-----------|-------|
| Layers | 2 (minimum) |
| Size | 80mm Ã— 60mm |
| Thickness | 1.6mm |
| Copper | 1oz |
| Finish | HASL or ENIG |
| Solder Mask | Black or Blue |

---

## Design Notes

### Power Considerations
- Keep high-current traces (buck converter) short and wide
- Place decoupling caps close to IC power pins
- Separate analog (audio) and digital grounds, join at one point

### ESP32-C3 EN Pin (Recommended)

Add RC delay circuit on EN pin for reliable startup:

```
3.3V â”€â”€â”€ 10K â”€â”€â”€â”¬â”€â”€â”€ EN pin
                â”‚
               10ÂµF
                â”‚
               GND
```

> This provides ~100ms delay, ensuring stable power before chip enables.

### RF Considerations
- Keep antenna area of ESP32-C3 clear of copper
- No ground plane under antenna
- USB traces should be 90Î© differential impedance

### Thermal Considerations
- MP2359 may need thermal via to bottom copper
- MAX98357A generates heat during playback

---

## Revision History

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2026-01-14 | Initial design |
| 1.1 | 2026-01-14 | Fixed buck FB resistors (16K/5.6K), added RTC INT pull-up, added EN RC circuit |

---

*Generated for Spiritual Assistant Project*
